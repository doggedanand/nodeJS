
doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Crud-App

    //- Bootstrap link
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous")

    //- Custom style link
    link(rel='stylesheet' href='/css/style.css')

    //- JQuery link
    script(src="https://code.jquery.com/jquery-3.6.4.min.js")

  body
    .container.mt-5
      h5.bold.text-center.color Welcome to Node.js CRUD using MongoDB, Express.js, and Pug.
      form(method="PUT" action=`/update/${users._id}`)
        .mb-3
          label.form-label(for="name") Name*
          input.form-control(type="text" id="name" name="name" value=users.name required pattern="[a-zA-Z ]+$")

        .mb-3
          label.form-label(for="age") Age*
          input.form-control(type="number" id="age" name="age" value=users.age required pattern="[0-9]+$")

        .mb-3
          label.form-label(for="gender") Gender*
          select.form-select(name="gender" required )
            option(value="male" selected=users.gender==="male") Male
            option(value="female" selected=users.gender==="female") Female
            option(value="other" selected=users.gender==="other") Other

        .mb-3
          label.form-label(for="designation") Designation*
          input.form-control(type="text" id="designation" name="designation" value=users.designation required pattern="[a-zA-Z ]+$")

        button.btn.btn-danger(type="submit" data-id=users._id ) Update User

    script.


      $(document).ready(function () {
        $("form").submit(function (event) {
          event.preventDefault();

          // get the user id from form attributes
          const userId = $(this).attr("action").split("/")[2];


          const formData = {
            name: $("#name").val(),
            age: $("#age").val(),
            gender: $('select[name=gender]').val(),
            designation: $("#designation").val(),
          }; 

          $.ajax({
            type: "PUT",
            url: `/update/${userId}`,
            contentType: "application/json",
            data: JSON.stringify(formData),
            success: function (res) {

              console.log("User updated successfully");
              alert("User updated successfully")
              window.location.href = "/";  
            },
            error: function (error) {

              console.error("Error updating user:", error);
            },
          });
        });
      });



