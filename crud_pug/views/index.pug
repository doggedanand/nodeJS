doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport" content="width=device-width, initial-scale=1.0")
    title Crud-App

    //- Bootstrap link
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous")

    //- Custom style link
    link(rel='stylesheet' href='/css/style.css')

    //- JQuery link
    script(src="https://code.jquery.com/jquery-3.6.4.min.js")

  body
    .container.mt-5
      h3.bold.text-center.color Welcome to Node.js CRUD using MongoDB, Express.js, and Pug.

      //- Form for adding users
      form(method="POST" action="/addUser")
        .mb-3
          label.form-label(for="name") Name*
          input.form-control(type="text" id="name" name="name" required pattern="[a-zA-Z ]+$")

        .mb-3
          label.form-label(for="age") Age*
          input.form-control(type="number" id="age" name="age" required)

        .mb-3
          label.form-label(for="gender") Gender*
          select.form-select(name="gender" required)
            option(value="") Select
            option(value="Male") Male
            option(value="Female") Female
            option(value="Other") Other

        .mb-3
          label.form-label(for="designation") Designation*
          input.form-control(type="text" id="designation" name="designation" required pattern="[a-zA-Z ]+$")

        button.btn.btn-danger(type="submit") Add User

    //- Table to show all added data
    .container.mt-3 
      table.table.table-striped.table-bordered
        thead
          tr
            th.color(scope="col") Name
            th.color(scope="col") Age
            th.color(scope="col") Gender
            th.color(scope="col") Designation
            th.color(scope="col") Action
        tbody
          //- each loop to interate the user data from database
          each user in users
            tr
              td= user.name
              td= user.age
              td= user.gender
              td= user.designation
              td
                a.btn.btn-success.btn-sm(href=`/editUser/${user._id}`  style="margin-right:5px") Edit
                a(href="" class="deleteUser btn btn-danger btn-sm" data-id=user._id) Delete
                //- href=`/edit/${user._id}` 
    script.
      console.log("working log")
      //alert("hello")
      $(document).ready(function() {
        console.log("==========")

        $('body').on('click', '.deleteUser', function(e) {
        e.preventDefault();
        console.log("==========")

        const userId = $(this).data('id');
        console.log('========',userId)
        $.ajax({
          url: `/delete/${userId}`,
          type: 'DELETE',
          contentType: 'application/json', 

          success: function(res) {
          console.log("ajax call")

          location.href='/'

          },
          error: function(error) {
          console.log("error ajax call")
          console.error(error);

          }

        });
        });
      });

      
      
